{
  "name": "Python",
  "image": "mcr.microsoft.com/devcontainers/python:1-3.13-bookworm",
  "features": {
    "ghcr.io/devcontainers-extra/features/pre-commit:2": {},
    "ghcr.io/meaningful-ooo/devcontainer-features/fish:1": {},
    "ghcr.io/va-h/devcontainers-features/uv:1": {}
  },
  "initializeCommand": {
    "create host uv cache dir": "mkdir -p ~/.cache/uv",
    "create permanent fish history": "mkdir -p ~/.devcontainer/${devcontainerId} && touch ~/.devcontainer/${devcontainerId}/fish_history"
  },
  "onCreateCommand": {
    "uv tox": "uv tool install tox --with tox-uv",
    "pre-commit hooks": "pre-commit install --install-hooks",
    "pre-commit type": "pre-commit install --hook-type commit-msg",
    "create venv": "uv venv"
  },
  "updateContentCommand": {
    "sync dependencies": "uv sync --all-groups",
    "uv completions": "uv generate-shell-completion fish > ~/.config/fish/completions/uv.fish"
  },
  "postCreateCommand": {
    "clean up tox": "rm -rf ${containerWorkspaceFolder}/.tox"
  },
  "containerEnv": {
    "UV_CACHE_DIR": "/home/vscode/.uv_cache",
    "UV_LINK_MODE": "symlink"
  },
  "mounts": [
    {
      "source": "${localEnv:HOME}/.cache/uv",
      "target": "/home/vscode/.uv_cache",
      "type": "bind"
    },
    {
      "source": "${localEnv:HOME}/.devcontainer/${devcontainerId}/fish_history",
      "target": "/home/vscode/.local/share/fish/fish_history",
      "type": "bind"
    }
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "njpwerner.autodocstring",
        "charliermarsh.ruff",
        "tamasfe.even-better-toml",
        "yzhang.markdown-all-in-one",
        "streetsidesoftware.code-spell-checker"
      ],
      "settings": {
        "[python]": {
          "editor.codeActionsOnSave": {
            "source.fixAll": "explicit",
            "source.organizeImports": "explicit"
          },
          "editor.defaultFormatter": "charliermarsh.ruff",
          "editor.formatOnSave": true
        },
        "files.exclude": {
          ".pytest_cache": true,
          "**/__pycache__": true,
          "**/*.egg-info": true
        },
        "python.analysis.extraPaths": ["src"],
        "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
        "python.terminal.activateEnvInCurrentTerminal": true,
        "python.linting.enabled": true,
        "python.testing.pytestArgs": ["."],
        "python.testing.pytestEnabled": true,
        "python.testing.pytestPath": "${workspaceFolder}/.venv/bin/pytest",
        "python.testing.unittestEnabled": false,
        "terminal.integrated.defaultProfile.linux": "fish",
        "cSpell.words": ["monopy"]
      }
    }
  }
}
